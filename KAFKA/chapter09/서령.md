# Chapter 09. ë°ì´í„° íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸°

- Apache Kafkaì—ì„œ 'ì •í™•íˆ í•œ ë²ˆ(Exactly Once)' ì˜ë¯¸ëŠ” ë‘ ê°€ì§€ í•µì‹¬ ê¸°ëŠ¥, ë©±ë“±ì  í”„ë¡œë“€ì„œ(idempotent producer)ì™€ íŠ¸ëœì­ì…˜(transaction)ì˜ ì¡°í•©ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.

## **9.1 ë°ì´í„° íŒŒì´í”„ë¼ì¸ êµ¬ì¶• ì‹œ ê³ ë ¤ì‚¬í•­**

### **9.1.1 ì ì‹œì„±**
- ì ì‹œì„±(Timeliness)ì€ ë°ì´í„°ê°€ ìƒì„±ëœ í›„ ê°€ëŠ¥í•œ í•œ ë¹ ë¥¸ ì‹œê°„ ë‚´ì— ìˆ˜ì§‘, ì ‘ì†¡, ì²˜ë¦¬ë˜ì–´ ìµœì¢… ì‚¬ìš©ìë‚˜ ì‹œìŠ¤í…œì— ë„ë‹¬í•˜ëŠ” ì†ë„ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
- ì‹¤ì‹œê°„ ë¶„ì„, ëª¨ë‹ˆí„°ë§, ê²½ê³  ì‹œìŠ¤í…œ ë“±ì—ì„œëŠ” ì ì‹œì„±ì´ ë§¤ìš° ì¤‘ìš”í•œ ìš”ì†Œì…ë‹ˆë‹¤. 


### **9.1.2 ì‹ ë¢°ì„±**
- ì‹ ë¢°ì„±ì— ëŒ€í•´ ìƒê°í•  ë•Œ ì¤‘ìš”í•œ ë˜ ë‹¤ë¥¸ ê³ ë ¤ì‚¬í•­ì€ ì „ë‹¬ ë³´ì¥(delivery guarantee)ì´ë‹¤.
- ì¹´í”„ì¹´ëŠ” ìì²´ì ìœ¼ë¡œ 'ìµœì†Œ í•œ ë²ˆ'ì „ë‹¬ì„ ë³´ì¥í•˜ë©°, íŠ¸ëœì­ì…˜ ëª¨ë¸ì´ë‚˜ ê³ ìœ  í‚¤ë¥¼ ì§€ì›í•˜ëŠ” ì™¸ë¶€ ë°ì´í„° ì €ì¥ì†Œì™€ ê²°í•©ëì„ ë•Œ 'ì •í™•íˆ í•œ ë²ˆ'ê¹Œì§€ë„ ë³´ì¥ì´ ê°€ëŠ¥í•˜ë‹¤.
- ì¹´í”„ì¹´ ì»¤ë„¥íŠ¸ APIê°€ ì˜¤í”„ì…‹ì„ ë‹¤ë£° ë•Œ ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ì˜ í†µí•©ì„ ì§€ì›í•˜ëŠ” APIë¥¼ ì œê³µí•˜ê¸° ë•Œë¬¸ì— 'ì •í™•íˆ í•œ ë²ˆ'ì „ë‹¬ì„ ë³´ì¥í•˜ëŠ” íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•˜ê¸° ìœ„í•œ ì»¤ë„¥í„°ë¥¼ ê°œë°œí•˜ëŠ” ê²ƒ ì—­ì‹œ ë” ì‰¬ì›Œì¡Œë‹¤.

### **9.1.3 ë†’ìœ¼ë©´ì„œë„ ì¡°ì • ê°€ëŠ¥í•œ ì²˜ë¦¬ìœ¨**


## **9.2 ì¹´í”„ì¹´ ì»¤ë„¥íŠ¸ vs í”„ë¡œë“€ì„œ/ì»¨ìŠˆë¨¸**

- Kafka Connectì™€ Kafka ClientëŠ” ê°ê°ì˜ ìš©ë„ì™€ ìƒí™©ì— ë”°ë¼ ì„ íƒí•  ìˆ˜ ìˆìŒ. 
  - **Kafka Connect**ê°€ ì ì ˆí•œ ê²½ìš°
    - ê°„ë‹¨í•œ ë°ì´í„° ì—°ë™ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë¼ë©´, ì‚¬ì „ ì œì‘ëœ ì»¤ë„¥í„°ê°€ ì¡´ì¬í•˜ê³  ì„¤ì •ë§Œìœ¼ë¡œ ì¶©ë¶„íˆ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ê²½ìš° Kafka Connectë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì ì ˆí•¨.
    - Kafka ConnectëŠ” ì‚¬ì „ ì œì‘ëœ ì»¤ë„¥í„°(JDBC, ES, HDFSë“±)ë¥¼ í™œìš©í•˜ì—¬ ì„¤ì •ë§Œìœ¼ë¡œ ì™¸ë¶€ ë°ì´í„° ì €ì¥ì†Œì™€ Kafkaë¥¼ ì—°ë™í•  ìˆ˜ ìˆìŒ.
  - **Kafka Client**ê°€ ì ì ˆí•œ ê²½ìš°
    - ì—°ë™ê³¼ì •ì—ì„œ ë§Œì•½ íŠ¹ë³„í•œ ì»¤ìŠ¤í…€ ì²˜ë¦¬ë‚˜ ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ í•„ìš”í•˜ë‹¤ë©´ Kafka Clientë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ê°œë°œí•˜ëŠ” ë°©ë²•ì„ ê³ ë ¤í•  ìˆ˜ ìˆìŒ.

## **9.3 ì¹´í”„ì¹´ ì»¤ë„¥íŠ¸**
- Kafka ConnectëŠ” Apache Kafkaì˜ êµ¬ì„± ìš”ì†Œ ì¤‘ í•˜ë‚˜ë¡œ, Kafkaì™€ ì™¸ë¶€ ì‹œìŠ¤í…œ(ë°ì´í„°ë² ì´ìŠ¤, íŒŒì¼ ì‹œìŠ¤í…œ, ê²€ìƒ‰ ì—”ì§„ ë“±)ê°„ì˜ ë°ì´í„° ì´ë™ì„ ì‰½ê³  ì•ˆì •ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” í”„ë ˆì„ì›Œí¬
- ì§ì ‘ Kafka Client(Producer/Consumer)ë¥¼ ì½”ë”©í•˜ì§€ ì•Šê³ ë„, ë°ì´í„° ì†ŒìŠ¤ì™€ ì‹±í¬(ì €ì¥ì†Œ)ë¥¼ ì—°ê²°í•  ìˆ˜ ìˆë„ë¡ í‘œì¤€í™”ëœ ì¸í„°í˜ì´ìŠ¤ì™€ ë¯¸ë¦¬ ë§Œë“¤ì–´ì§„ ì»¤ë„¥í„°ë¥¼ ì œê³µí•¨.
- Source Connector TaskëŠ” ì›ë³¸ ì‹œìŠ¤í…œìœ¼ë¡œë¶€í„° ë°ì´í„°ë¥¼ ì½ì–´ì™€ì„œ ì»¤ë„¥íŠ¸ ìë£Œ ê°ì²´ì˜ í˜•íƒœë¡œ ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ì— ì „ë‹¬ë§Œ í•´ì£¼ë©´ ëœë‹¤.
- Sink Connector TaskëŠ” ì›Œì»¤ë¡œë¶€í„° ì»¤ë„¥íŠ¸ ìë£Œ ê°ì²´ë¥¼ ë°›ì•„ì„œ ëŒ€ìƒ 
- ì¹´í”„ì¹´ ì»¤ë„¥íŠ¸ëŠ” ìë£Œ ê°ì²´ë¥¼ ì¹´í”„ì¹´ì— ì“¸ ë•Œ ì‚¬ìš©ë˜ëŠ” í˜•ì‹ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆë„ë¡ Convertorë¥¼ ì‚¬ìš©í•¨.

### **9.3.1 ì¹´í”„ì¹´ ì»¤ë„¥íŠ¸ ì‹¤í–‰í•˜ê¸°**
- **ì»¤ë„¥íŠ¸ ì›Œì»¤ì˜ í•µì‹¬ ì„¤ì •**
1. bootstrap.servers
- Kafka Client(Producer, Consumer, Kafka Connector)ê°€ Kafka Clusterì— ì²˜ìŒ ì—°ê²°í•  ë•Œ ì‚¬ìš©í•  ì´ˆê¸° ë¸Œë¡œì»¤ ì£¼ì†Œ ëª©ë¡ì„ ì§€ì •í•˜ëŠ” ì„¤ì • í•­ëª©
- ì´ ì„¤ì •ì€ Kafka Clusterì— ì—°ê²°í•˜ê³  ë©”íƒ€ë°ì´í„°(í´ëŸ¬ìŠ¤í„°ì˜ ë¸Œë¡œì»¤ ëª©ë¡, í† í”½ ì •ë³´ ë“±)ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ì§„ì…ì  ì—­í• 

2. group.id
- Kafka Connect ì›Œì»¤ë“¤ì€ ëª¨ë‘ ë™ì¼í•œ group.idë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ í•˜ë‚˜ì˜ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•¨.
- ë™ì¼í•œ ê·¸ë£¹ idë¥¼ ê°€ì§„ ì›Œì»¤ë“¤ì€ Kafka ë‚´ë¶€ì˜ íŠ¹ì • í† í”½(connect-configs, connect-offsets, connect-statusë“±)ì„ í†µí•´ ìƒíƒœ, ì˜¤í”„ì…‹, êµ¬ì„± ì •ë³´ë¥¼ ê³µìœ í•˜ê³  ì¡°ìœ¨í•¨.

3. plugin.path  
- ì»¤ë„¥íŠ¸ë¥¼ ì‹¤í–‰í•  ë•Œ ì»¤ë„¥í„°ê°€ ì–´ë””ì— ìœ„ì¹˜í•˜ëŠ”ì§€ configíŒŒì¼ì— ìœ„ì¹˜ë¥¼ ì§€ì •í•´ì•¼ í•¨.
- ì»¤ë„¥í„° jaríŒ¨í‚¤ì§€ê°€ ìˆëŠ” ë””ë ‰í† ë¦¬ë¥¼ configíŒŒì¼ì— ì§€ì •í•˜ê²Œ ë¨.
- ì˜ˆ: /opt/connectors/jdbcì™€ /opt/connectors/elasticì„ ë§Œë“¤ê³  ì´ ì•ˆì— ì»¤ë„¥í„° jaríŒŒì¼ê³¼ ëª¨ë“  ì˜ì¡´ì„±ë“¤ì„ ì €ì¥í•¨.
4. key.converterì™€ value.converter
- ì»¤ë„¥íŠ¸ëŠ” ì¹´í”„ì¹´ì— ì €ì¥ëœ ì—¬ëŸ¬ í˜•ì‹ì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ.
- ì¹´í”„ì¹´ì— ì €ì¥ë  ë©”ì‹œì§€ì˜ í‚¤ì™€ ë°¸ë¥˜ ë¶€ë¶„ ê°ê°ì— ëŒ€í•´ ì»¨ë²„í„°ë¥¼ ì„¤ì •í•´ ì¤„ ìˆ˜ ìˆìŒ.

5. rest.host.nameê³¼ rest.port
- ì»¤ë„¥í„°ë¥¼ ì„¤ì •í•˜ê±°ë‚˜ ëª¨ë‹ˆí„°ë§í•  ë•ŒëŠ” ì¹´í”„ì¹´ ì»¤ë„¥íŠ¸ì˜ REST APIë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë³´í†µ. REST APIì— ì‚¬ìš©í•  íŠ¹ì •í•œ í¬íŠ¸ê°’ì„ í• ë‹¹í•´ ì¤„ ìˆ˜ ìˆìŒ.

### **9.3.2 ì»¤ë„¥í„° ì˜ˆì œ: íŒŒì¼ ì†ŒìŠ¤ì™€ íŒŒì¼ ì‹±í¬**

1&#xFE0F;&#x20E3; ë¶„ì‚°ëª¨ë“œë¡œ ì»¤ë„¥íŠ¸ ìƒì„±
![resource0](../../assets/sr/ch09_01_ë¶„ì‚°ëª¨ë“œ%20ì»¤ë„¥íŠ¸ì›Œì»¤%20ì‹¤í–‰.png)

2&#xFE0F;&#x20E3; ì‹¤í–‰ì¤‘ì¸ Java í”„ë¡œì„¸ìŠ¤ í™•ì¸
![resource1](../../assets/sr/ch09_02.png)

3&#xFE0F;&#x20E3; Kafka Connectê°€ ë¡œë“œí•œ í”ŒëŸ¬ê·¸ì¸ ëª©ë¡ í™•ì¸
![resource2](../../assets/sr/ch09_03.png)
â†’ FileStreamSource ì»¤ë„¥í„° ì°¾ì§€ ëª»í•¨.

4&#xFE0F;&#x20E3; Kafka ê¸°ë³¸ ì œê³µ ì»¤ë„¥í„° ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜

![resource3](../../assets/sr/ch09_04.png)


5&#xFE0F;&#x20E3; plugin.path ì„¤ì • ì¶”ê°€
![resource4](../../assets/sr/ch09_05.png)

6&#xFE0F;&#x20E3; ì£¼ê¸°í¼ -> ì¹´í”„ì¹´ -> ì»¤ë„¥íŠ¸ ì¬ì‹œì‘

7&#xFE0F;&#x20E3; Kafka Connectê°€ ë¡œë“œí•œ í”Œë¡œì¸ ëª©ë¡ ë‹¤ì‹œ í™•ì¸
![resource5](../../assets/sr/ch09_06.PNG)
â†’ FileStreamSource ì»¤ë„¥í„° ì°¾ìŒ ã…ã…

8&#xFE0F;&#x20E3; Source Connector ìƒì„±
![resource6](../../assets/sr/ch09_07_sourceconnector.png)

9&#xFE0F;&#x20E3; Source Connector ìƒíƒœ í™•ì¸
![resource7](../../assets/sr/ch09_08.png)

ğŸ”Ÿ testíŒŒì¼ì— ë°ì´í„° ì¶”ê°€ ë° Kafkaì—ì„œ ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ìˆ˜ì§‘ë˜ëŠ”ì§€ í™•ì¸

![resource8](../../assets/sr/ch09_09.PNG)

1ï¸âƒ£1ï¸âƒ£ Sink Connector ìƒì„±  

![resource9](../../assets/sr/ch09_10_sink_connector.PNG)

1&#xFE0F;&#x20E3;2&#xFE0F;&#x20E3; Sink Connector ì •ìƒ ë“±ë¡ í™•ì¸
![resource10](../../assets/sr/ch09_11.PNG)


1&#xFE0F;&#x20E3;3&#xFE0F;&#x20E3; file-topicì— ë°ì´í„° ì¶”ê°€  

![resource11](../../assets/sr/ch09_12.PNG)

1&#xFE0F;&#x20E3;4&#xFE0F;&#x20E3; /tmp/output.txtì— ë°ì´í„° ì˜ ì €ì¥ë˜ì—ˆëŠ”ì§€ í™•ì¸  
![resource12](../../assets/sr/ch09_13.PNG)


### **9.3.3 ì»¤ë„¥í„° ì˜ˆì œ: MySQLì—ì„œ Elasticsearchë¡œ ë°ì´í„° ë³´ë‚´ê¸°**

### **9.3.4 ê°œë³„ ë©”ì‹œì§€ ë³€í™˜**

### **9.3.5 ì¹´í”„ì¹´ ì»¤ë„¥íŠ¸: ì¢€ ë” ìì„¸íˆ ì•Œì•„ë³´ê¸°**

1. ì»¤ë„¥í„°(Connector)ì™€ íƒœìŠ¤í¬(Task)
2. ì›Œì»¤(Worker)
3. ì»¨ë²„í„°(Convertor) ë° ì»¤ë„¥íŠ¸ ë°ì´í„° ëª¨ë¸
4. ì˜¤í”„ì…‹ ê´€ë¦¬


## **9.4 ì¹´í”„ì¹´ ì»¤ë„¥íŠ¸ì˜ ëŒ€ì•ˆ**

